---
title: "ego_ignorance"
author: "S. Shin"
date: '2022-10-28'
output: html_document
---

# Load packages
```{r}
library(dplyr)
library(ggplot2)
library(ggthemes)
library(tidyr)
library(AICcmodavg)
library(broom.mixed)
library(nnet)
library(lme4)
library(emmeans)
library(effectsize)
library(pwr)
library(tidyverse)
```

#EXPERIMENT 1

##Load Data
```{r}
df.ex1.trials <- read_csv("../../data/experiment_1/ego_ignorance_thesis-trials.csv")
```

##Wrangle Data
```{r}
#quick function to count occluders in a string
n_occluders <- Vectorize(function(x) {
  return(sum(as.numeric(strsplit(x, '')[[1]])))
})

#add some info
df.ex1.trials <- df.ex1.trials %>% 
  filter(workerid != 32) %>% #worker 32 timed out on prolific. Their submission is excluded
  mutate(
    response_alter_occluded = case_when(
      substring(alter_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    response_ego_occluded = case_when(
      substring(ego_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    num_ego_occluders = n_occluders(ego_occluders),
    num_alter_occluders = n_occluders(alter_occluders),
    response_ball_position = (response==ball_pos)
  ) 
```

##Calculate Pilot Bonus info
```{r}
df.ex1_pilot.rewards <- read_csv("../../data/experiment_1/pilot/ego_ignorance_thesis-participants.csv")
df.ex1_pilot.prolific_ids <- read_csv("../../data/experiment_1/pilot/ego_ignorance_thesis-workerids.csv")

# for 5 pilot subjects (workerids = 12, 13, 14, 15, 16)
#merge bonuses with prolific ids
df.ex1_pilot.rewards = df.ex1_pilot.rewards %>% 
  select(workerid, bonus) %>% 
  inner_join(df.ex1_pilot.prolific_ids) %>% 
  select(-workerid) %>% 
  relocate(prolific_participant_id) %>% 
  mutate(
    bonus = round(bonus, 2)
  )

#bonuses file, ready to paste into Prolific
write.table(df.ex1_pilot.rewards, "../../data/experiment_1/pilot/experiment_1-bonuses-pilot.txt", sep = ",", col.names = FALSE, row.names = FALSE, quote=FALSE)
```



##Calculate Ex1 Bonus info
```{r}
df.ex1.participants <- read_csv("../../data/experiment_1/ego_ignorance_thesis-participants.csv")
df.ex1.prolific_ids <- read_csv("../../data/experiment_1/ego_ignorance_thesis-workerids.csv")
df.ex1.prolific_demos <- read_csv("../../data/experiment_1/prolific_demos.csv") #demographics downloaded from prolific

#merge bonuses with prolific ids
df.ex1.rewards = df.ex1.participants %>% 
  filter(proliferate.condition=='Experiment 1') %>% 
  select(workerid, bonus) %>% 
  inner_join(df.ex1.prolific_ids) %>% 
  select(-workerid) %>% 
  relocate(prolific_participant_id) %>% 
  mutate(
    bonus = round(bonus, 2)
  ) %>% 
  filter(prolific_participant_id %in% df.ex1.prolific_demos$`Participant id`) #one participant timed out. Remove them be ensuring all participants are in the approved list from prolific demos

#bonuses file, ready to paste into Prolific
write.table(df.ex1.rewards, "../../data/experiment_1/experiment_1-bonuses.txt", sep = ",", col.names = FALSE, row.names = FALSE, quote=FALSE)

```
##Get Demographics
```{r}
#get demos
df.ex1.demos <- read_csv("../../data/experiment_1/ego_ignorance_thesis-participants.csv") 

ex1.demos.gender <- df.ex1.demos %>% 
  count(gender)
ex1.demos.gender
ex1.mean_age <- mean(df.ex1.demos$age)
ex1.mean_age
```


##Figures

###Interest in Alter Knowledge (violin)
```{r}

alter_ig_data_ex1_occluders <- df.ex1.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible'),
    num_alter_visible = 3 - num_alter_occluders
  ) %>% 
  group_by(ego_can_infer, workerid) %>% 
  summarize(
    total_alt_occluded = sum(num_alter_occluders),
    total_not_occluded = sum(num_alter_visible)
    ) 

alter_ig_data_ex1 <- df.ex1.trials %>%
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible'),
  ) %>% 
  group_by(ego_can_infer, response_alter_occluded, workerid) %>% 
  summarize(
    responses = n()
  ) %>% 
  inner_join(alter_ig_data_ex1_occluders) %>% 
  mutate(
    proportional_responses = case_when(
      response_alter_occluded == 'Occluded' ~ responses / total_alt_occluded,
      response_alter_occluded == 'Visible' ~ responses / total_not_occluded
    )
  )



#calculate means 
ex1_fig_means <- alter_ig_data_ex1  %>% 
  group_by(ego_can_infer, response_alter_occluded) %>% 
  dplyr::summarize(mean = mean(proportional_responses))


fig0 <- ggplot(
  data = alter_ig_data_ex1,
  mapping = aes(
    x = response_alter_occluded,
    y = proportional_responses,
    color = response_alter_occluded)
  ) +
  geom_point(
    position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2),
    size = 0.9,
    alpha = 1) +
  geom_violin(
    aes(alpha = 0),
    position = position_dodge(width=0.9)) +
  geom_boxplot(
    aes(alpha = 0),
    outlier.shape = NA,
    width = 0.15,
    position = position_dodge(width=0.9),
    fatten = NULL) +
  geom_line(
    data = ex1_fig_means,
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=ego_can_infer),
    color="grey30"
    ) +
  geom_point(
    data = ex1_fig_means, 
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=response_alter_occluded),
    position = position_dodge(width=0.9)
  ) + 
  facet_grid(~ego_can_infer) +
  xlab(element_blank()) +
  ylab("Percentage Responses") +
  theme_minimal() +
  scale_colour_ptol() +
  theme(
    legend.position = "none",
    strip.text.x = element_text(size = 14),
    axis.title = element_text(size = 14, margin = unit(c(0,0.2,0,0), 'cm')),
    axis.text = element_text(size = 12),)

ggsave(filename = "../../figures/plots/alter_knowledge_pilot_violin.pdf",
       width = 5,
       height = 4)

fig0
```

###Make right choice when there is one?
```{r}

#overall
alter_ig_data <- df.ex1.trials %>%
  count(collective_can_infer, accuracy) %>% 
  rename(responses = n)

fig1 <- ggplot(
  data = alter_ig_data,
  mapping = aes(
    x = collective_can_infer,
    y = responses,
    fill = accuracy)
  ) +
  geom_col(
    position = 'dodge'
  )


fig1

```

###Preference to select ball
```{r}

#overall
alter_ig_data <- df.ex1.trials %>% 
  count(ego_can_infer, response_ball_position) %>% 
  rename(responses = n)

fig1 <- ggplot(
  data = alter_ig_data,
  mapping = aes(
    x = ego_can_infer,
    y = responses,
    fill = response_ball_position)
  ) +
  geom_col(
    position = 'dodge'
  )


fig1

#for logical guesses, within conditions where ego_can_infer
alter_ig_data <- df.ex1.trials %>% 
  filter(ego_can_infer) %>% 
  count(alter_can_infer, response_ball_position) %>% 
  rename(responses = n)

fig2 <- ggplot(
  data = alter_ig_data,
  mapping = aes(
    x = alter_can_infer,
    y = responses,
    fill = response_ball_position)
  ) +
  geom_col(
    position = 'dodge'
  )


fig2
```

###Proposed analysis from thesis: Total Responses
```{r}
#take cases when ego can see at least one position, and alter can see nothing
alter_ig_data <- df.ex1.trials %>% 
  filter(
    ego_occluders == '011' | ego_occluders == '110' | ego_occluders == '101',
    alter_occluders == '111'
  ) %>% 
  group_by(ego_ball_visible) %>% 
  count(response_ego_occluded) %>% 
  rename(responses = n) %>% 
  mutate(
    responses = case_when(
      response_ego_occluded ~ responses * 0.5,
      !(response_ego_occluded) ~ responses * 1,
    )
  )

fig1 <- ggplot(
  data = alter_ig_data,
  mapping = aes(
    x = ego_ball_visible,
    y = responses,
    fill = response_ego_occluded)
  ) +
  geom_col(
    position = 'dodge'
  )


fig1
```

```{r}
#take cases when ego can see at least one position, and alter can see nothing
alter_ig_data <- df.ex1.trials %>% 
  filter(
    ego_occluders == '011' | ego_occluders == '110' | ego_occluders == '101',
    alter_occluders == '111'
  ) %>% 
  group_by(ego_ball_visible, workerid) %>% 
  count(response_ego_occluded) %>% 
  rename(responses = n) %>% 
  mutate(
    responses = case_when(
      response_ego_occluded ~ responses * 0.5,
      !(response_ego_occluded) ~ responses * 1,
    )
  )

alter_ig_proportions <- alter_ig_data %>% 
  group_by(ego_ball_visible, workerid) %>% 
  summarize(total_responses = sum(responses)) %>% 
  inner_join(alter_ig_data, by = c('workerid', 'ego_ball_visible')) %>% 
  filter(response_ego_occluded) %>% 
  mutate(
    proportion_responses_ego_occluded_corrected = responses / total_responses
  )

fig1 <- ggplot(
  data = alter_ig_proportions ,
  mapping = aes(
    x = ego_ball_visible,
    y = proportion_responses_ego_occluded_corrected)
  ) +
  geom_boxplot(
    position = 'dodge'
  ) +
  geom_point(
    position = 'jitter'
  )


fig1
```

###Proposed analysis from thesis: Responses by participant level probability
```{r}
alter_ig_data <- df.ex1.trials %>% 
  filter(#take cases when ego can see exactly one position and alter can see nothing
    ego_occluders == '011' | ego_occluders == '110' | ego_occluders == '101',
    alter_occluders == '111'
  ) %>% 
  group_by(ego_ball_visible, response_ego_occluded, workerid) %>% 
  summarise( #count the total number of times each participant selects the ego_occluded position, and the number of ego_occluded positions available in each condition
    responses = n(),
    total_ego_occluders = sum(num_ego_occluders)
    ) 

alter_ig_data_proportional <- alter_ig_data %>% 
  group_by(ego_ball_visible, workerid) %>% 
  summarise( #count the total number of ego occluders available by ego_ball_visible
    total_condition_ego_occluders = sum(total_ego_occluders)) %>% 
  inner_join(alter_ig_data, by = c('ego_ball_visible', 'workerid')) %>% 
  filter(response_ego_occluded) %>% 
  mutate(#calculate the probability of selecting an ego_occluded position (number of ego_occ positions selected divided by number of ego_occluded positions available in each condition)
    probability_response_ego_occluded = responses / total_condition_ego_occluders,
    probability_response_possible_location = case_when(
      ego_ball_visible ~ 1 - probability_response_ego_occluded,
      !(ego_ball_visible) ~ probability_response_ego_occluded
    )
  )
  
fig1 <- ggplot(
  data = alter_ig_data_proportional,
  mapping = aes(
    x = ego_ball_visible,
    y = probability_response_ego_occluded)
  ) +
  geom_boxplot(
    position = 'dodge'
  ) +
  geom_point(position = 'jitter')


fig1

fig2 <- ggplot(
  data = alter_ig_data_proportional,
  mapping = aes(
    x = ego_ball_visible,
    y = probability_response_possible_location)
  ) +
  geom_boxplot(
    position = 'dodge'
  ) +
  geom_point(position = 'jitter')


fig2
  

```

###Proposed analysis from thesis: RT
- Shows that when the ball is hidden, there's no effect
- When the ball is visible, it's more effortless to select the open position
```{r}
#take cases when ego can see at least one position, and alter can see nothing
alter_ig_data <- df.ex1.trials %>% 
  filter(
    ego_occluders == '011' | ego_occluders == '110' | ego_occluders == '101',
    alter_occluders == '111'
  ) %>% 
  group_by(workerid) %>% 
  filter(rt >= (mean(rt)-2.5*sd(rt)) & rt <= (mean(rt)+2.5*sd(rt))) %>% #filter to 2.5 sd for each participant
  group_by(ego_ball_visible, response_ego_occluded, workerid) %>% 
  summarize(rt = mean(rt))

fig1 <- ggplot(
  data = alter_ig_data,
  mapping = aes(
    x = ego_ball_visible,
    y = rt,
    fill = response_ego_occluded)
  ) +
  geom_boxplot(
    position = 'dodge'
  ) +
  geom_point(position='jitter') +
  ylim(0, 6000)


fig1

aov <- aov(rt ~ ego_ball_visible*response_ego_occluded, data=alter_ig_data)
summary(aov)
```

###Interest in alter knowlege? Total responses with sketchy correction
```{r}
#take cases when participant can't see ball and can or can't infer it's position. Is participant more likely to select a position if the character can see it? 
#Is this only the case when the participant can't infer the ball's location?
#correct for baseline proportion of cases which are alter_occluded


alter_ig_data <- df.ex1.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  group_by(ego_can_infer, response_alter_occluded) %>% 
  summarize(
    responses = n(),
    total_alt_occluded = sum(num_alter_occluders)
  )

corrected_alter_ig_data <- alter_ig_data %>% 
  group_by(ego_can_infer) %>% 
  summarize(
    proportion_alt_occluded = sum(total_alt_occluded) / (3*sum(responses)),
    proportion_not_occluded = 1 - proportion_alt_occluded
  ) %>% 
  inner_join(alter_ig_data) %>% 
  mutate(
    corrected_responses = case_when(
      response_alter_occluded=='Occluded' ~ responses / proportion_alt_occluded,
      response_alter_occluded == 'Visible' ~ responses / proportion_not_occluded
    )
  )

fig1 <- ggplot(
  data = corrected_alter_ig_data,
  mapping = aes(
    x = ego_can_infer,
    y = corrected_responses,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position = 'dodge'
  ) +
  xlab('Participant Knowledge State') +
  ylab('Corrected Responses') +
  scale_fill_discrete(name = "Character's Perspective") +
  theme_economist_white() +
  theme(axis.title.x = element_text(margin = unit(c(0.2,0,0,0), 'cm')), axis.title.y = element_text(margin = unit(c(0,0.2,0,0), 'cm')))

fig1

ggsave(filename = "../../figures/plots/alter_knowledge_pilot.pdf",
       width = 5,
       height = 4)

```

###Interest in alter knowlege? Responses by participant level probabilities (still sketchy)

```{r}
alter_ig_data <- df.ex1.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  group_by(ego_can_infer, response_alter_occluded, workerid) %>% 
  dplyr::summarize(
    responses = n(),
    total_alt_occluded = sum(num_alter_occluders)
  )

corrected_alter_ig_data <- alter_ig_data %>% 
  group_by(ego_can_infer, workerid) %>% 
  dplyr::summarize(
    total_condition_alt_occluded = sum(total_alt_occluded)) %>% 
  inner_join(alter_ig_data, by = c('ego_can_infer', 'workerid')) %>% 
  filter(response_alter_occluded) %>% 
  mutate(
    probability_response_alter_occluded = responses / total_condition_alt_occluded
  )


fig1 <- ggplot(
  data = corrected_alter_ig_data,
  mapping = aes(
    x = ego_can_infer,
    y = probability_response_alter_occluded)
  ) +
  geom_boxplot(
    position = 'dodge'
  ) +
  geom_point( position = 'jitter')

fig1

#supporting analysis--participants are more likely to select an alter_occluded position if they can infer where the ball is
aov.1 <- aov(probability_response_alter_occluded ~ ego_can_infer + workerid, data = corrected_alter_ig_data)
summary(aov.1)
```

###Interest in alter knowlege? RT
```{r}
#take cases when participant can't see ball and can or can't infer it's position. Is participant more likely to select a position if the character can see it? 
#Is this only the case when the participant can't infer the ball's location?
#correct for baseline proportion of cases which are alter_occluded
alter_ig_data <- df.ex1.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  group_by(ego_can_infer, response_alter_occluded, workerid) %>% 
  summarize(
    rt = mean(rt)
  )

fig1 <- ggplot(
  data = alter_ig_data,
  mapping = aes(
    x = ego_can_infer,
    y = rt,
    fill = response_alter_occluded)
  ) +
  geom_boxplot(
    position = 'dodge'
  ) + 
  geom_point(
    position = 'jitter'
  )

fig1

#supporting analysis--no significant overall effects or interaction
aov <- aov(rt ~ ego_can_infer*response_alter_occluded, data = alter_ig_data)
summary(aov)
```


###Interest in Alter Knowledge (split by alter_can_infer)
```{r}
alter_ig_ex1_data <- df.ex1.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2)) %>% 
  count(num_alter_occluders, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex1_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1


#filter to ego_occluders=111, and 1 or 2 alter occluders. Then, correct so it's the probaility of selecting a given position of the kind (half the value if there are twice as many of that kind)
alter_ig_ex1_data <- df.ex1.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2) & num_ego_occluders==3) %>% 
  count(num_alter_occluders, response_alter_occluded) %>% 
  mutate(
    n = as.numeric(n),
    n = case_when(
      num_alter_occluders==1 & !response_alter_occluded ~ n/2,
      num_alter_occluders==2 & response_alter_occluded ~ n/2,
      TRUE ~ n
    )
  )

fig1 <- ggplot(
  data = alter_ig_ex1_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1

#filter to 1 or 2 alter occluders. Then, correct so it's the probaility of selecting a given position of the kind (half the value if there are twice as many of that kind)
alter_ig_ex1_data <- df.ex1.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2)) %>% 
  count(num_alter_occluders, response_alter_occluded) %>% 
  mutate(
    n = as.numeric(n),
    n = case_when(
      num_alter_occluders==1 & !response_alter_occluded ~ n/2,
      num_alter_occluders==2 & response_alter_occluded ~ n/2,
      TRUE ~ n
    )
  )

fig1 <- ggplot(
  data = alter_ig_ex1_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1
```

## Analyses

### Proposed Analyses
```{r}
#RT
alter_ig_data <- df.ex1.trials %>% 
  filter(
    ego_occluders == '011' | ego_occluders == '110' | ego_occluders == '101',
    alter_occluders == '111'
  ) %>% 
  group_by(ego_ball_visible, response_ego_occluded, workerid) %>% 
  summarize(rt = mean(rt))

av.0 <- aov(rt ~ ego_ball_visible * response_ego_occluded, data = alter_ig_data)
summary(av.0)
```

### Interest in alter knowledge
```{r}

#Responses
#df.glm.0 <- df.ex1.trials 

#is the participant more likely to select a position that is alter occluded when they know where the ball is? aka 
#are they more likely to select an !alter_occluded position when they don't know where the ball is 
#glm.0 = glm(
#  response_alter_occluded ~ ego_can_infer + num_alter_occluders,
#  data = df.mult.0)


#using participant level probabilities of selecting an alter occluded position
alter_ig_data <- df.ex1.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  group_by(ego_can_infer, response_alter_occluded, workerid) %>% 
  summarize(
    responses = n(),
    total_alt_occluded = sum(num_alter_occluders)
  )


corrected_alter_ig_data <- alter_ig_data %>% 
  group_by(ego_can_infer, workerid) %>% 
  summarize(
    total_condition_alt_occluded = sum(total_alt_occluded)) %>% 
  inner_join(alter_ig_data, by = c('ego_can_infer', 'workerid')) %>% 
  filter(response_alter_occluded) %>% 
  mutate(
    probability_response_alter_occluded = responses / total_condition_alt_occluded
  )

#Are participants more likely to select alter occluded positions when they know where the ball is? (and therefore more likely to select alter-visible positions when they don't know where the ball is)
#performed on participant x condition 'probability score' (total number of occluded or non-occluded positions corrected for the baseline freuency of occluded or non-occluded positions)
aov.1 <- aov(probability_response_alter_occluded ~ ego_can_infer + workerid, data = corrected_alter_ig_data)
summary(aov.1)

```

###Interest in alter knowledge (GLM)
```{r}

df.ex1.glm.0 <- df.ex1.trials %>% 
  filter(
    !ego_ball_visible
  )

glm.0 <- glmer(
  formula = response_alter_occluded ~ ego_can_infer + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = df.ex1.glm.0,
  family = 'binomial')

glm.1 <- glmer(
  formula = response_alter_occluded ~ 1 + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = df.ex1.glm.0,
  family = 'binomial')

aov.1 <- anova(glm.0, glm.1)
aov.1
```


####Pairwise follow-up
```{r}
#get participant level summary
df.ex1.lm <- df.ex1.trials %>% 
  filter(
    !ego_can_infer
  ) %>% 
  group_by(response_alter_occluded, workerid) %>% 
  summarize(responses = n())

lm.1 <- lmer(
  formula = responses ~ response_alter_occluded + (1|workerid),  
  data = df.ex1.lm )

lm.2 <- lmer(
  formula = responses ~ 1 + (1|workerid),  
  data = df.ex1.lm )

anova(lm.1, lm.2)
```


####Post-hoc power analysis
```{r}

#cohens-f = 0.27 for affect of ego_can_infer
cohens_f(aov.1)

#power analysis based upon f=0.27, power=0.8, 
pwr.anova.test(k=2,            # 2 groups are compared
               f=.27,          # effect size due to ego_can_infer
               sig.level=.05,  # alpha/sig. level = .05
               power = 0.8)       # confint./power = .8
#shows n=55
```

#EXPERIMENT CONTROL

##Load Data
```{r}
df.control.trials <- read_csv("../../data/experiment_control/ego_ignorance_thesis_control-trials.csv")
```

##Wrangle Data
```{r}
#quick function to count occluders in a string
n_occluders <- Vectorize(function(x) {
  return(sum(as.numeric(strsplit(x, '')[[1]])))
})

#add some info
df.control.trials <- df.control.trials %>% 
  mutate(
    response_alter_occluded = case_when(
      substring(alter_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    response_ego_occluded = case_when(
      substring(ego_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    num_ego_occluders = n_occluders(ego_occluders),
    num_alter_occluders = n_occluders(alter_occluders),
    response_ball_position = (response==ball_pos),
    ego_can_infer = case_when(
                            ego_ball_visible ~ TRUE,
                            num_ego_occluders == 1 ~ TRUE,
                            TRUE ~ FALSE),
    collective_can_infer = case_when(
                            ego_can_infer & alter_can_infer ~ TRUE,
                            TRUE ~ FALSE)
    )
```

##Calculate Control Bonus info
```{r}
df.control.rewards <- read_csv("../../data/experiment_control/ego_ignorance_thesis_control-participants.csv")
df.control.prolific_ids <- read_csv("../../data/experiment_control/ego_ignorance_thesis_control-workerids.csv")

#merge bonuses with prolific ids
df.control.rewards = df.control.rewards %>% 
  select(workerid, bonus) %>% 
  inner_join(df.control.prolific_ids) %>% 
  select(-workerid) %>% 
  relocate(prolific_participant_id) %>% 
  mutate(
    bonus = round(bonus, 2)
  )

#bonuses file, ready to paste into Prolific
write.table(df.control.rewards, "../../data/experiment_control/control-bonuses.txt", sep = ",", col.names = FALSE, row.names = FALSE, quote=FALSE)

sum(df.control.rewards$bonus)
```

##Get Demographics
```{r}
#get demos
df.control.demos <- read_csv("../../data/experiment_control/ego_ignorance_thesis_control-participants.csv") 

control.demos.gender <- df.control.demos %>% 
  count(gender)
control.demos.gender
control.mean_age <- mean(df.control.demos$age, na.rm=TRUE)
control.mean_age
```

##Figures

###Make right choice when there is one?
-participants overwhelmingly choose the correct location when there is one
```{r}

control_good_choice <- df.control.trials %>%
  count(ego_can_infer, accuracy) %>% 
  rename(responses = n)

fig1 <- ggplot(
  data = control_good_choice,
  mapping = aes(
    x = ego_can_infer,
    y = responses,
    fill = accuracy)
  ) +
  geom_col(
    position = 'dodge'
  )


fig1

```

###Interest in Alter Knowledge
```{r}
alter_ig_control_data <- df.control.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(ego_can_infer, response_alter_occluded)

baseline_alter_occluded <- df.control.trials %>% 
  filter(!ego_ball_visible)

fig1 <- ggplot(
  data = alter_ig_control_data,
  mapping = aes(
    x = ego_can_infer,
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  ) +
  xlab('Participant Knowledge State') +
  ylab('Responses') +
  scale_fill_discrete(name = "Character's Perspective") +
  theme_economist_white() +
  theme(axis.title.x = element_text(margin = unit(c(0.2,0,0,0), 'cm')), axis.title.y = element_text(margin = unit(c(0,0.2,0,0), 'cm')))

fig1

ggsave(filename = "../../figures/plots/alter_knowledge_no_character.pdf",
       width = 5,
       height = 4)
```

###Interest in Alter Knowledge (violin)
```{r}
#get participant level summary (showing total responses)
alter_ig_control_data <- df.control.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(ego_can_infer, response_alter_occluded, workerid)

#quickly get the number of total responses in each category
control_total_responses <- alter_ig_control_data %>% 
  group_by(workerid, ego_can_infer) %>% 
  mutate(total_responses = sum(n))

#convert responses to percentages
alter_ig_control_data <- alter_ig_control_data %>% 
  inner_join(control_total_responses) %>% 
  mutate(percentage = (n / total_responses)*100)

#calculate means 
control_fig_means <- alter_ig_control_data %>% 
  group_by(ego_can_infer, response_alter_occluded) %>% 
  dplyr::summarize(mean = mean(percentage))

#make plot
fig1 <- ggplot(
  data = alter_ig_control_data,
  mapping = aes(
    x = response_alter_occluded,
    y = percentage,
    color = response_alter_occluded)
  ) +
  geom_point(
    position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2),
    size = 0.9,
    alpha = 1) +
  geom_violin(
    aes(alpha = 0),
    position = position_dodge(width=0.9)) +
  geom_boxplot(
    aes(alpha = 0),
    outlier.shape = NA,
    width = 0.15,
    position = position_dodge(width=0.9),
    fatten = NULL) +
  geom_line(
    data = control_fig_means,
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=ego_can_infer),
    color="grey30"
    ) +
  geom_point(
    data = control_fig_means, 
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=response_alter_occluded),
    position = position_dodge(width=0.9)
  ) + 
  facet_grid(~ego_can_infer) +
  xlab(element_blank()) +
  ylab("Participant Responses (percent)") +
  ylim(0, 100) +
  theme_minimal() +
  scale_colour_ptol() +
  theme(
    legend.position = "none",
    strip.text.x = element_text(size = 14),
    axis.title = element_text(size = 14, margin = unit(c(0,0.2,0,0), 'cm')),
    axis.text = element_text(size = 12),) 

ggsave(filename = "../../figures/plots/alter_knowledge_no_character_violin.pdf",
       width = 5,
       height = 4)

fig1

```

###Interest in Alter Knowledge from index

```{r}
control_alter_ig_data <- df.control.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  group_by(ego_can_infer, response_alter_occluded, workerid) %>% 
  dplyr::summarize(
    responses = n(),
    total_alt_occluded = sum(num_alter_occluders)
  )

corrected_control_alter_ig_data <- control_alter_ig_data %>% 
  group_by(ego_can_infer, workerid) %>% 
  dplyr::summarize(
    total_condition_alt_occluded = sum(total_alt_occluded)) %>% 
  inner_join(control_alter_ig_data, by = c('ego_can_infer', 'workerid')) %>% 
  filter(response_alter_occluded) %>% 
  mutate(
    probability_response_alter_occluded = responses / total_condition_alt_occluded
  )


fig1 <- ggplot(
  data = corrected_control_alter_ig_data,
  mapping = aes(
    x = ego_can_infer,
    y = probability_response_alter_occluded)
  ) +
  geom_boxplot(
    position = 'dodge'
  ) +
  geom_point( position = 'jitter')

fig1
```


##Analyses

###Interest in alter knowledge
```{r}
#using participant level probabilities of selecting an alter occluded position
control_alter_ig_data <- df.control.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  group_by(ego_can_infer, response_alter_occluded, workerid) %>% 
  dplyr::summarize(
    responses = n(),
    total_alt_occluded = sum(num_alter_occluders)
  )


corrected_alter_ig_data <- alter_ig_data %>% 
  group_by(ego_can_infer, workerid) %>% 
  summarize(
    total_condition_alt_occluded = sum(total_alt_occluded)) %>% 
  inner_join(alter_ig_data, by = c('ego_can_infer', 'workerid')) %>% 
  filter(response_alter_occluded) %>% 
  mutate(
    probability_response_alter_occluded = responses / total_condition_alt_occluded
  )

```

###Interest in alter knowledge (GLM)
```{r}

control_alter_ig_data <- df.control.trials %>% 
  filter(
    !ego_ball_visible
  )

glm.2 <- glmer(
  formula = response_alter_occluded ~ ego_can_infer + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = control_alter_ig_data,
  family = 'binomial')

glm.3 <- glmer(
  formula = response_alter_occluded ~ 1 + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = control_alter_ig_data,
  family = 'binomial')

aov.1 <- anova(glm.2, glm.3)

aov.1
```

####Pairwise follow-up
```{r}
#get participant level summary
df.control.lm <- df.control.trials %>% 
  filter(
    !ego_can_infer
  ) %>% 
  group_by(response_alter_occluded, workerid) %>% 
  summarize(responses = n())

lm.3 <- lmer(
  formula = responses ~ response_alter_occluded + (1|workerid),  
  data = df.control.lm )

lm.4 <- lmer(
  formula = responses ~ 1 + (1|workerid),  
  data = df.control.lm )

anova(lm.3, lm.4)
```

#EXPERIMENT 2

##Load Data
```{r}
df.ex2.trials <- read_csv("../../data/experiment_2/ego_ignorance_thesis_experiment_2-trials.csv")
```

##Wrangle Data
```{r}
#quick function to count occluders in a string
n_occluders <- Vectorize(function(x) {
  return(sum(as.numeric(strsplit(x, '')[[1]])))
})

#add some info
df.ex2.trials <- df.ex2.trials %>% 
  mutate(
    response_alter_occluded = case_when(
      substring(alter_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    response_ego_occluded = case_when(
      substring(ego_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    num_ego_occluders = n_occluders(ego_occluders),
    num_alter_occluders = n_occluders(alter_occluders),
    response_ball_position = (response==ball_pos))
```

##Calculate Control Bonus info
```{r}
df.ex2.rewards <- read_csv("../../data/experiment_2/ego_ignorance_thesis_experiment_2-participants.csv")
df.ex2.prolific_ids <- read_csv("../../data/experiment_2/ego_ignorance_thesis_experiment_2-workerids.csv")

#merge bonuses with prolific ids
df.ex2.rewards = df.ex2.rewards %>% 
  select(workerid, bonus) %>% 
  inner_join(df.ex2.prolific_ids) %>% 
  select(-workerid) %>% 
  relocate(prolific_participant_id) %>% 
  mutate(
    bonus = round(bonus, 2)
  )

#bonuses file, ready to paste into Prolific
write.table(df.ex2.rewards, "../../data/experiment_2/ex2-bonuses.txt", sep = ",", col.names = FALSE, row.names = FALSE, quote=FALSE)

mean(df.ex2.rewards$bonus)
```

##Get Demographics
```{r}
#get demos
df.ex2.demos <- read_csv("../../data/experiment_2/ego_ignorance_thesis_experiment_2-participants.csv") 

ex2.demos.gender <- df.ex2.demos %>% 
  count(gender)
ex2.demos.gender
ex2.mean_age <- mean(df.ex2.demos$age)
ex2.mean_age
```

##Figures

###Interest in Alter Knowledge
```{r}
alter_ig_ex2_data <- df.ex2.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(ego_can_infer, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = ego_can_infer,
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  ) +
  xlab('Participant Knowledge State') +
  ylab('Responses') +
  scale_fill_discrete(name = "Character's Perspective") +
  theme_economist_white() +
  theme(axis.title.x = element_text(margin = unit(c(0.2,0,0,0), 'cm')), axis.title.y = element_text(margin = unit(c(0,0.2,0,0), 'cm')))

fig1


ggsave(filename = "../../figures/plots/alter_knowledge_character.pdf",
       width = 5,
       height = 4)
```

###Interest in Alter Knowledge (violin)
```{r}
alter_ig_ex2_data <- df.ex2.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(ego_can_infer, response_alter_occluded, workerid)

#quickly get the number of total responses in each category
ex2_total_responses <- alter_ig_ex2_data %>% 
  group_by(workerid, ego_can_infer) %>% 
  mutate(total_responses = sum(n))

#convert responses to percentages
alter_ig_ex2_data <- alter_ig_ex2_data %>% 
  inner_join(ex2_total_responses) %>% 
  mutate(percentage = (n / total_responses)*100)

#calculate means 
ex2_fig_means <- alter_ig_ex2_data %>% 
  group_by(ego_can_infer, response_alter_occluded) %>% 
  dplyr::summarize(mean = mean(percentage))

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = response_alter_occluded,
    y = percentage,
    color = response_alter_occluded)
  ) +
  geom_point(
    position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2),
    size = 0.9,
    alpha = 1) +
  geom_violin(
    aes(alpha = 0),
    position = position_dodge(width=0.9)) +
  geom_boxplot(
    aes(alpha = 0),
    outlier.shape = NA,
    width = 0.15,
    position = position_dodge(width=0.9),
    fatten = NULL) +
  geom_line(
    data = ex2_fig_means,
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=ego_can_infer),
    color="grey30"
    ) +
  geom_point(
    data = ex2_fig_means, 
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=response_alter_occluded),
    position = position_dodge(width=0.9)
  ) + 
  facet_grid(~ego_can_infer) +
  xlab(element_blank()) +
  ylab("Participant Responses (percent)") +
  ylim(0, 100) +
  theme_minimal() +
  scale_colour_ptol() +
  theme(
    legend.position = "none",
    strip.text.x = element_text(size = 14),
    axis.title = element_text(size = 14, margin = unit(c(0,0.2,0,0), 'cm')),
    axis.text = element_text(size = 12),)

ggsave(filename = "../../figures/plots/alter_knowledge_character_violin.pdf",
       width = 5,
       height = 4)

fig1
```

###Interest in Alter Knowledge in complete ego_ignorance
```{r}
alter_ig_ex2_data <- df.ex2.trials %>% 
  filter(
    ego_occluders == '111' & (num_alter_occluders == 1 | num_alter_occluders == 2)
  ) %>% 
  count(response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = response_alter_occluded,
    y = n)
  ) +
  geom_col(
    position='dodge'
  )

fig1

ggsave(filename = "../../figures/plots/exp2_alter_knowledge.pdf",
       width = 8,
       height = 4)


alter_ig_ex2_data <- df.ex2.trials %>% 
  filter(
    ego_occluders == '111' & (num_alter_occluders == 1 | num_alter_occluders == 2)
  ) %>% 
  count(num_alter_occluders, response_alter_occluded)  %>% 
  mutate(
    n = as.numeric(n),
    n = case_when(
      num_alter_occluders==1 & !response_alter_occluded ~ n/2,
      num_alter_occluders==2 & response_alter_occluded ~ n/2,
      TRUE ~ n
    )
  )

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1

ggsave(filename = "../../figures/plots/exp2_alter_knowledge.pdf",
       width = 8,
       height = 4)
```

###Interest in Alter Knowledge (split by alter_can_infer)
```{r}
alter_ig_ex2_data <- df.ex2.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2)) %>% 
  count(num_alter_occluders, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1


#filter to ego_occluders=111, and 1 or 2 alter occluders. Then, correct so it's the probaility of selecting a given position of the kind (half the value if there are twice as many of that kind)
alter_ig_ex2_data <- df.ex2.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2) & num_ego_occluders==3) %>% 
  count(num_alter_occluders, response_alter_occluded) %>% 
  mutate(
    n = as.numeric(n),
    n = case_when(
      num_alter_occluders==1 & !response_alter_occluded ~ n/2,
      num_alter_occluders==2 & response_alter_occluded ~ n/2,
      TRUE ~ n
    )
  )

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1

#filter to 1 or 2 alter occluders. Then, correct so it's the probaility of selecting a given position of the kind (half the value if there are twice as many of that kind)
alter_ig_ex2_data <- df.ex2.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2)) %>% 
  count(num_alter_occluders, response_alter_occluded) %>% 
  mutate(
    n = as.numeric(n),
    n = case_when(
      num_alter_occluders==1 & !response_alter_occluded ~ n/2,
      num_alter_occluders==2 & response_alter_occluded ~ n/2,
      TRUE ~ n
    )
  )

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1


#filter to 1 or 2 alter occluders. Then, correct so it's the probaility of selecting a given position of the kind (half the value if there are twice as many of that kind)
alter_ig_ex2_data <- df.ex2.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==2)) %>% 
  count(alter_occluders, response_alter_occluded) %>% 
  mutate(
    n = as.numeric(n),
    n = case_when(
      response_alter_occluded ~ n/2,
      TRUE ~ n
    )
  )

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = factor(alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1

alter_ig_ex2_data <- df.ex2.trials %>% 
  count(response)

fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = factor(response),
    y = n)
  ) +
  geom_col(
    position='dodge'
  )

fig1

#considering only ego_occ=111, filter to 1 or 2 alter occluders. Then, correct so it's the probaility of selecting a given position of the kind (half the value if there are twice as many of that kind)
alter_ig_ex2_data <- df.ex2.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==2 | num_alter_occluders==1)) %>% 
  filter(ego_occluders == '111') %>% 
  count(num_alter_occluders, response_alter_occluded)


fig1 <- ggplot(
  data = alter_ig_ex2_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1
```

###Make right choice when there is one?
-participants make the correct choice when there is one, and do not when there isn't
```{r}

#overall
ex2_right_choice <- df.ex2.trials %>%
  count(collective_can_infer, accuracy) %>% 
  rename(responses = n)

fig1 <- ggplot(
  data = ex2_right_choice,
  mapping = aes(
    x = collective_can_infer,
    y = responses,
    fill = accuracy)
  ) +
  geom_col(
    position = 'dodge'
  )


fig1

```

###Preference to select ball
-if participants know where the ball is, they tend to select that position regardless of the knowledge state of the character
```{r}

#overall
ex2_select_ball <- df.ex1.trials %>% 
  count(ego_can_infer, response_ball_position) %>% 
  rename(responses = n)

fig1 <- ggplot(
  data = ex2_select_ball,
  mapping = aes(
    x = ego_can_infer,
    y = responses,
    fill = response_ball_position)
  ) +
  geom_col(
    position = 'dodge'
  )


fig1

#for logical guesses, within conditions where ego_can_infer
alter_ig_data <- df.ex1.trials %>% 
  filter(ego_can_infer) %>% 
  count(alter_can_infer, response_ball_position) %>% 
  rename(responses = n)

fig2 <- ggplot(
  data = alter_ig_data,
  mapping = aes(
    x = alter_can_infer,
    y = responses,
    fill = response_ball_position)
  ) +
  geom_col(
    position = 'dodge'
  )


fig2
```

###Interest in alter knowlege? RT
```{r}
#take cases when participant can't see ball and can or can't infer it's position. Are participants more likely to select a position if the character can see it? 
#Is this only the case when the participant can't infer the ball's location?

alter_ig_data <- df.ex2.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  group_by(ego_can_infer, response_alter_occluded, workerid) %>% 
  filter(rt < 4000) %>% 
  summarize(
    rt = mean(rt)
  )

fig1 <- ggplot(
  data = alter_ig_data,
  mapping = aes(
    x = ego_can_infer,
    y = rt,
    fill = response_alter_occluded)
  ) +
  geom_boxplot(
    position = 'dodge'
  ) + 
  geom_point(
    position = 'jitter'
  )

fig1
```

##Analyses

###Interest in alter knowledge from responses (GLM)
```{r}

ex2_alter_ig_data <- df.ex2.trials %>% 
  filter(
    !ego_ball_visible
  )

glm.4 <- glmer(
  formula = response_alter_occluded ~ ego_can_infer + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = ex2_alter_ig_data,
  family = 'binomial')

glm.5 <- glmer(
  formula = response_alter_occluded ~ 1 + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = ex2_alter_ig_data,
  family = 'binomial')

aov.1 <- anova(glm.4, glm.5)

aov.1
```
####Pairwise follow-up
```{r}
#get participant level summary
df.ex2.lm <- df.ex2.trials %>% 
  filter(
    !ego_can_infer
  ) %>% 
  group_by(response_alter_occluded, workerid) %>% 
  summarize(responses = n())

lm.5 <- lmer(
  formula = responses ~ response_alter_occluded + (1|workerid),  
  data = df.ex2.lm )

lm.6 <- lmer(
  formula = responses ~ 1 + (1|workerid),  
  data = df.ex2.lm )

anova(lm.5, lm.6)
```

###Interest in alter knowledge from rt (GLM)

```{r}

ex2_alter_ig_data <- df.ex2.trials %>% 
  filter(
    !ego_ball_visible
  )

lm.1 <- lmer(
  formula = rt ~ ego_can_infer + response_alter_occluded + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = ex2_alter_ig_data)


lm.2 <- lmer(
  formula = rt ~ response_alter_occluded + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = ex2_alter_ig_data)

anova(lm.1, lm.2)
```

#EXPERIMENT 3

##Load Data
```{r}
df.ex3.trials <- read_csv("../../data/experiment_3/ego_ignorance_thesis_experiment_3-trials.csv")
```

##Wrangle Data
```{r}
#quick function to count occluders in a string
n_occluders <- Vectorize(function(x) {
  return(sum(as.numeric(strsplit(x, '')[[1]])))
})

#add some info
df.ex3.trials <- df.ex3.trials %>% 
  mutate(
    response_alter_occluded = case_when(
      substring(alter_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    response_ego_occluded = case_when(
      substring(ego_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    num_ego_occluders = n_occluders(ego_occluders),
    num_alter_occluders = n_occluders(alter_occluders),
    response_ball_position = (response==ball_pos))
```

##Calculate Bonus info
```{r}
df.ex3.rewards <- read_csv("../../data/experiment_3/ego_ignorance_thesis_experiment_3-participants.csv")
df.ex3.prolific_ids <- read_csv("../../data/experiment_3/ego_ignorance_thesis_experiment_3-workerids.csv")

# one participant 5ec0ba1bfa01894cceaa1b8e did not finish with a completion code, and their data were not recorded

#merge bonuses with prolific ids
df.ex3.rewards = df.ex3.rewards %>% 
  select(workerid, bonus) %>% 
  inner_join(df.ex3.prolific_ids) %>% 
  select(-workerid) %>% 
  relocate(prolific_participant_id) %>% 
  mutate(
    bonus = round(bonus, 2)
  )

#bonuses file, ready to paste into Prolific
write.table(df.ex3.rewards, "../../data/experiment_3/ex3-bonuses.txt", sep = ",", col.names = FALSE, row.names = FALSE, quote=FALSE)

mean(df.ex3.rewards$bonus)
```

##Get Demographics
```{r}
#get demos
df.ex3.demos <- read_csv("../../data/experiment_3/ego_ignorance_thesis_experiment_3-participants.csv") 

ex3.demos.gender <- df.ex3.demos %>% 
  count(gender)
ex3.demos.gender
ex3.mean_age <- mean(df.ex3.demos$age)
ex3.mean_age
```

##Figures

###Interest in Alter Knowledge
```{r}
alter_ig_ex3_data <- df.ex3.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(ego_can_infer, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex3_data,
  mapping = aes(
    x = ego_can_infer,
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  ) +
  xlab('Participant Knowledge State') +
  ylab('Responses') +
  scale_fill_discrete(name = "Character's Perspective") +
  theme_economist_white() +
  theme(axis.title.x = element_text(margin = unit(c(0.2,0,0,0), 'cm')), axis.title.y = element_text(margin = unit(c(0,0.2,0,0), 'cm')))

fig1

ggsave(filename = "../../figures/plots/alter_knowledge_lamp.pdf",
       width = 5,
       height = 4)
```

###Interest in Alter Knowledge (violin)
```{r}
alter_ig_ex3_data <- df.ex3.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(ego_can_infer, response_alter_occluded, workerid)

#quickly get the number of total responses in each category
ex3_total_responses <- alter_ig_ex3_data %>% 
  group_by(workerid, ego_can_infer) %>% 
  mutate(total_responses = sum(n))

#convert responses to percentages
alter_ig_ex3_data <- alter_ig_ex3_data %>% 
  inner_join(ex3_total_responses) %>% 
  mutate(percentage = (n / total_responses)*100)

#calculate means 
ex3_fig_means <- alter_ig_ex3_data %>% 
  group_by(ego_can_infer, response_alter_occluded) %>% 
  dplyr::summarize(mean = mean(percentage))

fig1 <- ggplot(
  data = alter_ig_ex3_data,
  mapping = aes(
    x = response_alter_occluded,
    y = percentage,
    color = response_alter_occluded)
  ) +
  geom_point(
    position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2),
    size = 0.9,
    alpha = 1) +
  geom_violin(
    aes(alpha = 0),
    position = position_dodge(width=0.9)) +
  geom_boxplot(
    aes(alpha = 0),
    outlier.shape = NA,
    width = 0.15,
    position = position_dodge(width=0.9),
    fatten = NULL) +
  geom_line(
    data = ex3_fig_means,
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=ego_can_infer),
    color="grey30"
    ) +
  geom_point(
    data = ex3_fig_means, 
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=response_alter_occluded),
    position = position_dodge(width=0.9)
  ) + 
  facet_grid(~ego_can_infer) +
  xlab(element_blank()) +
  ylab("Participant Responses (percent)") +
  ylim(0,100) +
  theme_minimal() +
  scale_colour_ptol() +
  theme(
    legend.position = "none",
    strip.text.x = element_text(size = 14),
    axis.title = element_text(size = 14, margin = unit(c(0,0.2,0,0), 'cm')),
    axis.text = element_text(size = 12),)

ggsave(filename = "../../figures/plots/alter_knowledge_lamp_violin.pdf",
       width = 5,
       height = 4)

fig1
```


###Interest in Alter Knowledge (split by alter_can_infer)
```{r}
alter_ig_ex3_data <- df.ex3.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2)) %>% 
  count(num_alter_occluders, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex3_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1


#filter to ego_occluders=111, and 1 or 2 alter occluders. Then, correct so it's the probaility of selecting a given position of the kind (half the value if there are twice as many of that kind)
alter_ig_ex3_data <- df.ex3.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2) & num_ego_occluders==3) %>% 
  count(num_alter_occluders, response_alter_occluded) %>% 
  mutate(
    n = as.numeric(n),
    n = case_when(
      num_alter_occluders==1 & !response_alter_occluded ~ n/2,
      num_alter_occluders==2 & response_alter_occluded ~ n/2,
      TRUE ~ n
    )
  )

fig1 <- ggplot(
  data = alter_ig_ex3_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1

#filter to 1 or 2 alter occluders. Then, correct so it's the probaility of selecting a given position of the kind (half the value if there are twice as many of that kind)
alter_ig_ex3_data <- df.ex3.trials %>% 
  filter((!ego_ball_visible) & (!ego_can_infer) & (num_alter_occluders==1 | num_alter_occluders==2)) %>% 
  count(num_alter_occluders, response_alter_occluded) %>% 
  mutate(
    n = as.numeric(n),
    n = case_when(
      num_alter_occluders==1 & !response_alter_occluded ~ n/2,
      num_alter_occluders==2 & response_alter_occluded ~ n/2,
      TRUE ~ n
    )
  )

fig1 <- ggplot(
  data = alter_ig_ex3_data,
  mapping = aes(
    x = factor(num_alter_occluders),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1
```

###Make right choice when there is one?
-participants overwhelmingly choose the correct location when there is one
```{r}

ex3_good_choice <- df.ex3.trials %>%
  count(ego_can_infer, accuracy) %>% 
  rename(responses = n)

fig1 <- ggplot(
  data = ex3_good_choice,
  mapping = aes(
    x = ego_can_infer,
    y = responses,
    fill = accuracy)
  ) +
  geom_col(
    position = 'dodge'
  )


fig1

```

##Analyses

###Interest in alter knowledge from responses (GLM)
```{r}

ex3_alter_ig_data <- df.ex3.trials %>% 
  filter(
    !ego_ball_visible
  )

glm.6 <- glmer(
  formula = response_alter_occluded ~ ego_can_infer + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = ex3_alter_ig_data,
  family = 'binomial')

glm.7 <- glmer(
  formula = response_alter_occluded ~ 1 + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = ex3_alter_ig_data,
  family = 'binomial')

aov.2 <- anova(glm.6, glm.7)

aov.2
```

####Pairwise follow-up
```{r}
#get participant level summary
df.ex3.lm <- df.ex3.trials %>% 
  filter(
    !ego_can_infer
  ) %>% 
  group_by(response_alter_occluded, workerid) %>% 
  summarize(responses = n())

lm.7 <- lmer(
  formula = responses ~ response_alter_occluded + (1|workerid),  
  data = df.ex3.lm )

lm.8 <- lmer(
  formula = responses ~ 1 + (1|workerid),  
  data = df.ex3.lm )

anova(lm.7, lm.8)
```

#EXPERIMENT 4

##Load Data
```{r}
df.ex4.trials <- read_csv("../../data/experiment_4/ego_ignorance_thesis_experiment_4-trials.csv")
```

##Wrangle Data
```{r}
#quick function to count occluders in a string
n_occluders <- Vectorize(function(x) {
  return(sum(as.numeric(strsplit(x, '')[[1]])))
})

#add some info
df.ex4.trials <- df.ex4.trials %>% 
  mutate(
    response_alter_occluded = case_when(
      substring(alter_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    response_ego_occluded = case_when(
      substring(ego_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    num_ego_occluders = n_occluders(ego_occluders),
    num_alter_occluders = n_occluders(alter_occluders),
    response_ball_position = (response==ball_pos),
    trial_type = case_when(trick_trial~'trick', filler_trial~'filler', key_trial~'key'))
```

##Calculate Bonus info
```{r}
df.ex4.rewards <- read_csv("../../data/experiment_4/ego_ignorance_thesis_experiment_4-participants.csv")
df.ex4.prolific_ids <- read_csv("../../data/experiment_4/ego_ignorance_thesis_experiment_4-workerids.csv")

# one participant 5ec0ba1bfa01894cceaa1b8e did not finish with a completion code, and their data were not recorded

#merge bonuses with prolific ids
df.ex4.rewards = df.ex4.rewards %>% 
  select(workerid, bonus) %>% 
  inner_join(df.ex4.prolific_ids) %>% 
  select(-workerid) %>% 
  relocate(prolific_participant_id) %>% 
  mutate(
    bonus = round(bonus, 2)
  )

#bonuses file, ready to paste into Prolific
write.table(df.ex4.rewards, "../../data/experiment_4/ex4-bonuses.txt", sep = ",", col.names = FALSE, row.names = FALSE, quote=FALSE)

mean(df.ex4.rewards$bonus)
```

##Get Demographics
```{r}
#get demos
df.ex4.demos <- read_csv("../../data/experiment_4/ego_ignorance_thesis_experiment_4-participants.csv") 

ex4.demos.gender <- df.ex4.demos %>% 
  count(gender)
ex4.demos.gender
ex4.mean_age <- mean(df.ex4.demos$age)
ex4.mean_age
```

##Figures

###Interest in Alter Knowledge
```{r}
alter_ig_ex4_data <- df.ex4.trials %>% 
  filter(
    key_trial | trick_trial
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(trial_type, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex4_data,
  mapping = aes(
    x = trial_type,
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  ) +
  xlab('Participant Knowledge State') +
  ylab('Responses') +
  scale_fill_discrete(name = "Character's Perspective") +
  theme_economist_white() +
  theme(axis.title.x = element_text(margin = unit(c(0.2,0,0,0), 'cm')), axis.title.y = element_text(margin = unit(c(0,0.2,0,0), 'cm')))

fig1

ggsave(filename = "../../figures/plots/alter_knowledge_trick.pdf",
       width = 5,
       height = 4)
```
###Examine Filler Trials
```{r}
#select filler trials from ex4
ex4_fillers <- df.ex4.trials %>% 
  filter(
    filler_trial
  ) %>% 
  mutate(experiment = 4) %>% 
  select(alter_can_infer, ego_can_infer, num_alter_occluders, num_ego_occluders, response_alter_occluded, experiment, workerid)

#select ex2 trials that are analogous to ex4 fillers
ex2_fillers <- df.ex2.trials %>% 
  filter(!(!ego_can_infer & num_alter_occluders >=1 & alter_occluders != '111')) %>% 
  mutate(experiment = 2) %>% 
  select(alter_can_infer, ego_can_infer, num_alter_occluders, num_ego_occluders, response_alter_occluded, experiment, workerid)

#put ex2 and ex4 fillers together
compare_fillers <- rbind(ex4_fillers, ex2_fillers)

#summarize for figure
compare_fillers_fig <- compare_fillers %>% 
  count(experiment, response_alter_occluded)

fig1 <- ggplot(
  data = compare_fillers_fig,
  mapping = aes(
    x = factor(experiment),
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1

#summarise baseline occurances in ex2 and ex4 fillers
summarise_fillers <- compare_fillers %>% 
  mutate(
    alter_can_infer = case_when(alter_can_infer ~ 1, TRUE ~ 0),
    ego_can_infer = case_when(ego_can_infer ~ 1, TRUE ~ 0)
         ) %>% 
  group_by(experiment) %>% 
  summarise(
    mean_alter_occs = mean(num_alter_occluders),
    mean_ego_can_infer = mean(ego_can_infer),
    mean_alter_can_infer = mean(alter_can_infer)) 

summarise_fillers
```

###Ego Occlusion Effect
- In trick trials, participants were vastly more likely to select positions they could not see, AND the character could not see (mutually occluded positions). In all trick trials, though, there were either two or three ego occluded positions, so this is expected.
```{r}
alter_ig_ex4_data <- df.ex4.trials %>% 
  filter(
    trick_trial
  ) %>% 
  count(response_ego_occluded, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex4_data,
  mapping = aes(
    x = response_alter_occluded,
    y = n,
    fill = response_ego_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1

alter_ig_ex4_data <- df.ex4.trials %>% 
  filter(
    key_trial
  ) %>% 
  count(response_ego_occluded, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex4_data,
  mapping = aes(
    x = response_alter_occluded,
    y = n,
    fill = response_ego_occluded)
  ) +
  geom_col(
    position='dodge'
  )

fig1
```

#Analyses

##Preregistered Analysis
```{r}


ex4_alter_ig_data <- df.ex4.trials %>% 
  filter(
    trick_trial | key_trial
  )

glm.6 <- glmer(
  formula = response_alter_occluded ~ trick_trial + num_alter_occluders + (trick_trial + 
     num_alter_occluders|workerid),  
  data = ex4_alter_ig_data,
  family = 'binomial')

glm.7 <- glmer(
  formula = response_alter_occluded ~ 1 + num_alter_occluders + ( 
     num_alter_occluders|workerid),  
  data = ex4_alter_ig_data,
  family = 'binomial')

aov.3 <- anova(glm.6, glm.7)

tidy(aov.3)
```

##Examine Baseline Differences
```{r}

glm.6 <- glmer(
  formula = response_alter_occluded ~ experiment + num_alter_occluders + (experiment + 
     num_alter_occluders|workerid),  
  data = compare_fillers,
  family = 'binomial')

glm.7 <- glmer(
  formula = response_alter_occluded ~ 1 + num_alter_occluders + ( 
     num_alter_occluders|workerid),  
  data = compare_fillers,
  family = 'binomial')

aov.3 <- anova(glm.6, glm.7)

tidy(aov.3)
```
#EXPERIMENT 5

##Load Data
```{r}
df.ex5.trials <- read_csv("../../data/experiment_5/ego_ignorance_thesis_experiment_5-trials.csv")
```

##Wrangle Data
```{r}
#quick function to count occluders in a string
n_occluders <- Vectorize(function(x) {
  return(sum(as.numeric(strsplit(x, '')[[1]])))
})

#add some info
df.ex5.trials <- df.ex5.trials %>% 
  mutate(
    response_alter_occluded = case_when(
      substring(alter_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    response_ego_occluded = case_when(
      substring(ego_occluders, response+1, response+1) == '1' ~ TRUE,
      TRUE ~ FALSE
    ),
    num_ego_occluders = n_occluders(ego_occluders),
    num_alter_occluders = n_occluders(alter_occluders),
    response_ball_position = (response==ball_pos))
```

##Calculate Bonus info
```{r}
df.ex5.rewards <- read_csv("../../data/experiment_5/ego_ignorance_thesis_experiment_5-participants.csv")
df.ex5.prolific_ids <- read_csv("../../data/experiment_5/ego_ignorance_thesis_experiment_5-workerids.csv")

# one participant 5ec0ba1bfa01894cceaa1b8e did not finish with a completion code, and their data were not recorded

#merge bonuses with prolific ids
df.ex5.rewards = df.ex5.rewards %>% 
  select(workerid, bonus) %>% 
  inner_join(df.ex5.prolific_ids) %>% 
  select(-workerid) %>% 
  relocate(prolific_participant_id) %>% 
  mutate(
    bonus = round(bonus, 2)
  )

#bonuses file, ready to paste into Prolific
write.table(df.ex5.rewards, "../../data/experiment_5/ex5-bonuses.txt", sep = ",", col.names = FALSE, row.names = FALSE, quote=FALSE)

mean(df.ex5.rewards$bonus)
```

##Get Demographics
```{r}
#get demos
df.ex5.demos <- read_csv("../../data/experiment_5/ego_ignorance_thesis_experiment_5-participants.csv") 

ex5.demos.gender <- df.ex5.demos %>% 
  count(gender)
ex5.demos.gender
ex5.mean_age <- mean(df.ex5.demos$age)
ex5.mean_age
```

##Figures

###Interest in Alter Knowledge
```{r}
alter_ig_ex5_data <- df.ex5.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(ego_can_infer, response_alter_occluded)

fig1 <- ggplot(
  data = alter_ig_ex5_data,
  mapping = aes(
    x = ego_can_infer,
    y = n,
    fill = response_alter_occluded)
  ) +
  geom_col(
    position='dodge'
  ) +
  xlab('Participant Knowledge State') +
  ylab('Responses') +
  scale_fill_discrete(name = "Character's Perspective") +
  theme_economist_white() +
  theme(axis.title.x = element_text(margin = unit(c(0.2,0,0,0), 'cm')), axis.title.y = element_text(margin = unit(c(0,0.2,0,0), 'cm')))




fig1

ggsave(filename = "../../figures/plots/alter_knowledge_character_control.pdf",
       width = 5,
       height = 4)
```

###Interest in Alter Knowledge (violin)
```{r}
alter_ig_ex5_data <- df.ex5.trials %>% 
  filter(
    !ego_ball_visible
  ) %>% 
  mutate(
    ego_can_infer = case_when(ego_can_infer~'Knowledge', TRUE~'Ignorance'),
    response_alter_occluded = case_when(response_alter_occluded~"Occluded", TRUE~'Visible')
  ) %>% 
  count(ego_can_infer, response_alter_occluded, workerid)

#quickly get the number of total responses in each category
ex5_total_responses <- alter_ig_ex5_data %>% 
  group_by(workerid, ego_can_infer) %>% 
  mutate(total_responses = sum(n))

#convert responses to percentages
alter_ig_ex5_data <- alter_ig_ex5_data %>% 
  inner_join(ex5_total_responses) %>% 
  mutate(percentage = (n / total_responses)*100)

#calculate means 
ex5_fig_means <- alter_ig_ex5_data %>% 
  group_by(ego_can_infer, response_alter_occluded) %>% 
  dplyr::summarize(mean = mean(percentage))


fig1 <- ggplot(
  data = alter_ig_ex5_data,
  mapping = aes(
    x = response_alter_occluded,
    y = percentage,
    color = response_alter_occluded)
  ) +
  geom_point(
    position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2),
    size = 0.9,
    alpha = 1) +
  geom_violin(
    aes(alpha = 0),
    position = position_dodge(width=0.9)) +
  geom_boxplot(
    aes(alpha = 0),
    outlier.shape = NA,
    width = 0.15,
    position = position_dodge(width=0.9),
    fatten = NULL) +
  geom_line(
    data = ex5_fig_means,
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=ego_can_infer),
    color="grey30"
    ) +
  geom_point(
    data = ex5_fig_means, 
    mapping = aes(x = response_alter_occluded, 
      y = mean, 
      group=response_alter_occluded),
    position = position_dodge(width=0.9)
  ) + 
  facet_grid(~ego_can_infer) +
  xlab(element_blank()) +
  ylab("Participant Responses (percent)") +
  ylim(0, 100) +
  theme_minimal() +
  scale_colour_ptol() +
  theme(
    legend.position = "none",
    strip.text.x = element_text(size = 14),
    axis.title = element_text(size = 14, margin = unit(c(0,0.2,0,0), 'cm')),
    axis.text = element_text(size = 12))

ggsave(filename = "../../figures/plots/alter_knowledge_character_control_violin.pdf",
       width = 5,
       height = 4)

fig1
```

##Analyses

###Interest in alter knowledge from responses (GLM)
```{r}

ex5_alter_ig_data <- df.ex5.trials %>% 
  filter(
    !ego_ball_visible
  )

glm.10 <- glmer(
  formula = response_alter_occluded ~ ego_can_infer + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = ex5_alter_ig_data,
  family = 'binomial')

glm.11 <- glmer(
  formula = response_alter_occluded ~ 1 + num_alter_occluders + (ego_can_infer + num_alter_occluders|workerid),  
  data = ex5_alter_ig_data,
  family = 'binomial')

aov.5 <- anova(glm.10, glm.11)

aov.5
```

####Pairwise follow-up
```{r}
#get participant level summary
df.ex5.lm <- df.ex5.trials %>% 
  filter(
    !ego_can_infer
  ) %>% 
  group_by(response_alter_occluded, workerid) %>% 
  summarize(responses = n())

lm.9 <- lmer(
  formula = responses ~ response_alter_occluded + (1|workerid),  
  data = df.ex5.lm )

lm.10 <- lmer(
  formula = responses ~ 1 + (1|workerid),  
  data = df.ex5.lm )

anova(lm.9, lm.10)
```

# COMBINED FIGURES/ANALYSES

##'Correct' Choices?
```{r}

#overall df
combined_data <- df.ex1.trials %>% 
  rbind(df.control.trials, df.ex2.trials, df.ex3.trials, df.ex5.trials) %>% 
  mutate(
    Experiment = case_when(
      proliferate.condition=="Experiment 1" ~ 'Pilot',
     proliferate.condition== 'Pilot (test data collection)' ~ 'Pilot',
      proliferate.condition=="Experiment 2" ~ 'Experiment 1',
      proliferate.condition=="Experiment 3" ~ 'Experimen 3',
      proliferate.condition=="Experiment 5" ~ 'Experiment 4',
      proliferate.condition=="Control" ~ 'Experiment 2'
    ),
    Experiment = factor(Experiment, levels = c('Pilot', 'Experiment 1', 'Experiment 2', 'Experimen 3', 'Experiment 4'))
  )

#RATIONAL CHOICE ACCURACY
combined_accuracy_data <- combined_data %>%
  filter(collective_can_infer) %>% 
  count(accuracy, Experiment, workerid) %>% 
  rename(Responses = n) %>% 
  mutate(accuracy = case_when(accuracy ~ 'correct', TRUE ~ 'incorrect')) %>% 
  pivot_wider(names_from = accuracy, values_from = Responses) %>% 
  mutate(Accuracy = correct / (correct + incorrect)) %>% 
  group_by(Experiment) %>% 
  summarise(mean = mean(Accuracy, na.rm=TRUE), sd = sd(Accuracy, na.rm=TRUE))
combined_accuracy_data

#OVERALL ACCURACY
combined_accuracy_data_overall <- combined_data %>% 
  count(accuracy, Experiment, workerid) %>% 
  rename(Responses = n) %>% 
  mutate(accuracy = case_when(accuracy ~ 'correct', TRUE ~ 'incorrect')) %>% 
  pivot_wider(names_from = accuracy, values_from = Responses) %>% 
  mutate(Accuracy = correct / (correct + incorrect)) %>% 
  group_by(Experiment) %>% 
  summarise(mean = mean(Accuracy, na.rm=TRUE), sd = sd(Accuracy, na.rm=TRUE))
combined_accuracy_data_overall

median_rt <- median(combined_data$rt)

```

##PREF TO SELECT BALL?
```{r}
combined_select_ball <- combined_data %>% 
  filter(
    Experiment == 'Pilot' | Experiment == "Experiment 1" &
    ego_can_infer &
    !alter_can_infer) %>% 
  count(response_ball_position, Experiment, workerid) %>% 
  mutate(responses = n)

workerid_counts <- combined_select_ball %>% 
  group_by(workerid) %>% 
  summarize(total_trials = sum(responses))

combined_select_ball <- combined_select_ball %>% 
  inner_join(workerid_counts) %>% 
  mutate(proportional_response = responses / total_trials)

combined_select_ball_means <- combined_select_ball %>% 
  group_by(Experiment, response_ball_position) %>% 
  summarize(means = mean(proportional_response))
  

fig1 <- ggplot(
  data = combined_select_ball,
  mapping = aes(
    x = response_ball_position,
    y = proportional_response,
    color = response_ball_position)
  ) +
  geom_point(
    position = position_jitterdodge(dodge.width = 0.9, jitter.width = 0.2),
    size = 0.9,
    alpha = 1) +
  geom_violin(
    aes(alpha = 0),
    position = position_dodge(width=0.9)) +
  geom_boxplot(
    aes(alpha = 0),
    outlier.shape = NA,
    width = 0.15,
    position = position_dodge(width=0.9),
    fatten = NULL) +
  geom_line(
    data = combined_select_ball_means,
    mapping = aes(x = response_ball_position, 
      y = means, 
      group=Experiment),
    color="grey30"
    ) +
  geom_point(
    data = combined_select_ball_means, 
    mapping = aes(x = response_ball_position, 
      y = means, 
      group=Experiment),
    position = position_dodge(width=0.9)
  ) + 
  facet_grid(~Experiment) +
  xlab("Selected Ball's Position?")+ 
  ylab("Percent Responses") +
  theme_minimal() +
  scale_colour_ptol() +
  theme(
    legend.position = "none",
    strip.text.x = element_text(size = 14),
    axis.title = element_text(size = 14, margin = unit(c(0,0.2,0,0), 'cm')),
    axis.text = element_text(size = 12),)


fig1

  
ggsave(filename = "../../figures/plots/preference_select_ball.pdf",
       width = 5,
       height = 4)

```

```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
